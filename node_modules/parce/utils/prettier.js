const prettier = require('prettier');

const prettierOptions = require('../prettier.config.js');

const { parser: defaultParserName, overrides = [], ...defaultOptions } = prettierOptions;

const prettierOptionsMap = overrides.reduce(
    (prev, cur) => {
        const { parser: parserName, overrideOptions } = cur.options;
        prev[parserName] = {
            ...defaultOptions,
            ...overrideOptions
        };
        return prev;
    },
    {
        [defaultParserName]: defaultOptions
    }
);

const getFormatCode = (code = '', parser = defaultParserName) => {
    return prettier.format(code, { parser, ...prettierOptionsMap[parser] });
};

module.exports = {
    getFormatCode
};
